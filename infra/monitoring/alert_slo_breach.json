{
  "displayName": "MCC OCR Pipeline SLO Breach (${ENV})",
  "combiner": "OR",
  "conditions": [
    {
      "displayName": "Pipeline success ratio < 99.5% (30m)",
      "conditionMonitoringQueryLanguage": {
        "duration": "1800s",
        "query": "fetch prometheus_target\n| { metric 'prometheus.googleapis.com/mcc_pipeline_events_total' | filter metric.label.stage = 'storage' && metric.label.name = 'jobs_completed_total' | align rate(5m) | group_by [], sum(val()) ; metric 'prometheus.googleapis.com/mcc_pipeline_events_total' | filter metric.label.stage = 'storage' && metric.label.name = 'dlq_messages_total' | align rate(5m) | group_by [], sum(val()) }\n| join\n| value.a / (value.a + value.b)\n| condition val() < 0.995"
      }
    }
  ],
  "notificationChannels": [
    "projects/${PROJECT_ID}/notificationChannels/${ENV}-pagerduty",
    "projects/${PROJECT_ID}/notificationChannels/${ENV}-email"
  ],
  "documentation": {
    "content": "Runbook: https://runbooks.mcc/ocr/${ENV}/pipeline-slo",
    "mimeType": "text/markdown"
  },
  "alertStrategy": {
    "autoClose": "7200s"
  },
  "enabled": true
}
